<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Player — Final</title>

  <!-- Shaka (unchanged core) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.ui.min.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css" crossorigin="anonymous">

  <style>
    :root{
      --sky-1:#e6f7ff; --sky-2:#f8fbff;
      --dark-pink:#d81b60;
      --promo-red:#ff1f1f;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;width:100%}
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      color:#071427;
      background:
        radial-gradient(circle at 10% 20%, rgba(255,255,255,0.10) 0.4px, transparent 0.6px),
        radial-gradient(circle at 30% 60%, rgba(255,255,255,0.06) 0.4px, transparent 0.6px),
        linear-gradient(180deg,var(--sky-1) 0%, var(--sky-2) 100%);
      background-size:40px 40px,40px 40px,auto;
      min-height:100vh;
    }

    .page{max-width:1100px;margin:18px auto;padding:12px;z-index:1}
    h1.title{font-size:20px;margin-bottom:10px;color:#071427}

    /* ASPECT CONTROLS: left-to-right */
    .controls-row{
      display:flex;
      align-items:center;
      gap:10px;
      justify-content:flex-start;
      margin-bottom:10px;
      flex-wrap:wrap;
    }
    .controls-row label{font-weight:700;color:#071427}
    .controls-row select, .controls-row button{
      padding:8px 12px;border-radius:8px;border:0;background:#0b1220;color:#fff;cursor:pointer;font-weight:600;
      box-shadow:0 6px 18px rgba(11,18,32,0.12);
    }

    /* player wrapper and aspect ratios */
    .player-wrapper{
      width:100%;max-width:1000px;margin:0 auto;position:relative;
      border-radius:12px;overflow:hidden;box-shadow:0 12px 40px rgba(7,20,40,0.12);background:#000
    }
    .player-wrapper.aspect-16-9{padding-top:56.25%}
    .player-wrapper.aspect-4-3{padding-top:75%}
    .player-wrapper.aspect-1-1{padding-top:100%}
    .player-wrapper.aspect-fit{padding-top:56.25%}
    .player-wrapper.aspect-fill{padding-top:0;height:60vh}

    .shaka-video-container{position:absolute;inset:0;width:100%;height:100%}
    .shaka-video-container video{width:100%;height:100%;object-fit:contain;background:#000}

    /* iframe wrapper mirrors the player area exactly */
    .iframe-wrapper{
      position:absolute;inset:0;width:100%;height:100%;display:none;background:#000;overflow:hidden;
    }
    .iframe-wrapper iframe{width:100%;height:100%;border:0;object-fit:contain}

    /* overlay circular button (top corner) */
    .overlay-btn{
      position:absolute;top:10px;right:10px;z-index:99999;width:44px;height:44px;border-radius:22px;
      display:flex;align-items:center;justify-content:center;background:rgba(11,18,32,0.72);color:#fff;font-weight:800;
      border:1px solid rgba(255,255,255,0.06);cursor:pointer;font-size:16px;box-shadow:0 8px 22px rgba(11,18,32,0.28);
      transition:transform .12s,background .12s;
    }
    .overlay-btn:hover{transform:translateY(-3px)}
    .overlay-btn[aria-pressed="true"]{background:var(--dark-pink)}

    /* server2 button */
    .server2-area{max-width:1000px;margin:12px auto;display:flex;justify-content:center}
    .server2-btn{padding:12px 18px;border-radius:10px;background:var(--dark-pink);color:#fff;font-weight:800;border:0;cursor:pointer;box-shadow:0 8px 22px rgba(216,27,96,0.18)}

    /* promo buttons (4) and premium CTA */
    .promo-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;max-width:760px;margin:16px auto}
    .promo-grid a{display:flex;align-items:center;justify-content:center;padding:10px;border-radius:8px;background:#fff;border:1px solid rgba(0,0,0,0.06);text-decoration:none;font-weight:700;color:var(--promo-red);font-size:12px}
    .promo-cta{display:block;text-align:center;margin:12px auto;padding:10px 14px;border-radius:10px;background:linear-gradient(90deg,#ff4d4d,#ff7a6a);color:#fff;font-weight:900;text-decoration:none;max-width:760px}

    footer{margin-top:14px;text-align:center;color:#071427;font-weight:700}

    /* Mobile landscape fullscreen styles */
    .landscape-fullscreen {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      width: 100vw !important;
      height: 100vh !important;
      z-index: 9999 !important;
      background: #000 !important;
      border-radius: 0 !important;
      max-width: none !important;
      padding-top: 0 !important;
    }

    .landscape-fullscreen .iframe-wrapper,
    .landscape-fullscreen .shaka-video-container {
      width: 100% !important;
      height: 100% !important;
    }

    .landscape-fullscreen iframe,
    .landscape-fullscreen video {
      width: 100% !important;
      height: 100% !important;
      object-fit: cover !important;
    }

    .landscape-fullscreen .overlay-btn {
      z-index: 99999 !important;
    }

    @media (max-width:720px){
      .controls-row{justify-content:center}
      .player-wrapper.aspect-fill{height:48vh}
      
      /* Mobile specific landscape handling */
      .landscape-fullscreen {
        transform-origin: center center;
      }
      
      @media (orientation: landscape) {
        .landscape-fullscreen iframe,
        .landscape-fullscreen video {
          object-fit: cover !important;
          width: 100vw !important;
          height: 100vh !important;
        }
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <h1 class="title">Live Stream</h1>

    <!-- Aspect controls (left→right) -->
    <div class="controls-row" aria-label="Player controls">
      <label for="aspectSelect">Aspect:</label>
      <select id="aspectSelect" aria-label="Aspect ratio selector">
        <option value="aspect-16-9" selected>16:9</option>
        <option value="aspect-4-3">4:3</option>
        <option value="aspect-1-1">1:1</option>
        <option value="aspect-fit">Fit to Width</option>
        <option value="aspect-fill">Fill to Screen</option>
      </select>
      <button id="cinemaBtn">Cinema</button>
      <button id="fsBtn">Fullscreen</button>
      <button id="vrBtn">VR</button>
    </div>

    <!-- Player wrapper -->
    <div id="playerWrapper" class="player-wrapper aspect-16-9">
      <!-- SHAKA (original core, untouched) -->
      <div class="shaka-video-container" data-shaka-player>
        <video id="mainVideo" autoplay playsinline preload="metadata" poster="https://i.ibb.co/PGkCs5vz/ab188872-6178-43c2-a831-22a3de37390b.png"></video>
      </div>

      <!-- IFRAME (Server2) occupies exactly same space -->
      <div id="iframeWrapper" class="iframe-wrapper" aria-hidden="true">
        <iframe id="server2Iframe" src="" allow="autoplay; fullscreen" allowfullscreen referrerpolicy="no-referrer"></iframe>
      </div>

      <!-- overlay button appended by JS into playerWrapper -->
    </div>

    <!-- Server2 button centered -->
    <div class="server2-area">
      <button id="server2Btn" class="server2-btn">Server 2</button>
    </div>

    <!-- Promo buttons (4) -->
    <div class="promo-grid" aria-hidden="false">
      <a id="promo1" href="https://t.me/+-c580a3MZ05mNGFl" target="_blank" rel="noopener">JOIN CHANNEL 1</a>
      <a id="promo2" href="https://t.me/+-c580a3MZ05mNGFl" target="_blank" rel="noopener">JOIN CHANNEL 2</a>
      <a id="promo3" href="https://t.me/+-c580a3MZ05mNGFl" target="_blank" rel="noopener">JOIN CHANNEL 3</a>
      <a id="promo4" href="https://t.me/+-c580a3MZ05mNGFl" target="_blank" rel="noopener">JOIN CHANNEL 4</a>
    </div>

    <a class="promo-cta" href="https://t.me/+-c580a3MZ05mNGFl" target="_blank" rel="noopener">सभी लोग हमारे प्रीमियम सदस्य बनने के लिए JOIN करें</a>

    <footer>©</footer>
  </div>

  <!-- ========== ORIGINAL SHAKA PLAYER SCRIPT (kept untouched) ========== -->
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      shaka.polyfill.installAll();
      if (!shaka.Player.isBrowserSupported()) { console.error('Browser not supported'); return; }

      const video = document.getElementById('mainVideo');
      const player = new shaka.Player();
      await player.attach(video);

      const container = document.querySelector('.shaka-video-container');
      const ui = new shaka.ui.Overlay(player, container, video);

      ui.configure({
        controlPanelElements: [
          'play_pause','time_and_duration','mute','volume',
          'spacer','language','captions','picture_in_picture',
          'quality','fullscreen'
        ],
        volumeBarColors:{ base:'rgba(255,192,203,0.3)', level:'rgb(255,105,180)' },
        seekBarColors:{ base:'rgba(255,255,0,0.3)', buffered:'rgba(255,255,0,0.6)', played:'rgb(255,255,0)' }
      });

      // ====== DRM / cookie / stream configuration (UNCHANGED) ======
      let drmConfig = {
        clearKeys: {
          "31b13c6f241055aaa965263f3115e684": "61f0cbc9599925a7be93d45e30b8ebe9"
        }
      };

      let cookieHeader = "__hdnea__=st=1758392406~exp=1758478806~acl=/*~hmac=48d94f13ec574d6d9798365f006cd430ccd5ca3d776bde0a3335f979bf794bc5";

      let streamUrl = "https://jiotvbpkmob.cdn.jio.com/bpk-tv/Asia_Cup_Hindi_MOB/WDVLive/index.mpd?__hdnea__=st=1758392406~exp=1758478806~acl=/*~hmac=48d94f13ec574d6d9798365f006cd430ccd5ca3d776bde0a3335f979bf794bc5";

      player.configure({
        drm: drmConfig,
        streaming: {
          lowLatencyMode: true,
          bufferingGoal: 15,
          rebufferingGoal: 2,
          bufferBehind: 15,
          retryParameters: { timeout:10000, maxAttempts:5, baseDelay:300, backoffFactor:1.2 },
          segmentRequestTimeout:8000, segmentPrefetchLimit:2, useNativeHlsOnSafari:true
        },
        manifest: { retryParameters:{ timeout:8000, maxAttempts:3 } }
      });

      player.getNetworkingEngine().registerRequestFilter((type, request) => {
        request.headers['Referer'] = 'https://www.jiotv.com/';
        request.headers['User-Agent'] = "plaYtv/7.1.5 (Linux;Android 13) ExoPlayerLib/2.11.6";
        request.headers['Cookie'] = cookieHeader;

        if ((type === shaka.net.NetworkingEngine.RequestType.MANIFEST ||
             type === shaka.net.NetworkingEngine.RequestType.SEGMENT) &&
            request.uris[0] && !request.uris[0].includes('__hdnea=')) {
          const separator = request.uris[0].includes('?') ? '&' : '?';
          request.uris[0] += separator + cookieHeader;
        }
      });

      const enableAutoplay = () => { video.setAttribute('autoplay',''); video.setAttribute('playsinline',''); video.autoplay = true; };
      const attemptAutoplay = async () => {
        try { video.muted = false; await video.play(); return true; }
        catch(e){ try{ video.muted = true; await video.play(); return true }catch(e2){return false} }
      };

      player.addEventListener('error', (event) => { console.error('Shaka Player Error:', event.detail); });

      video.addEventListener('play', () => {
        if (window.self === window.top && !document.fullscreenElement && window.innerWidth <= 768) {
          container.requestFullscreen().catch(()=>{});
        }
      }, { once: true });

      video.addEventListener('loadedmetadata', ()=>{ video.volume = 0.8; });

      let hasUserInteracted = false;
      const enableSoundOnInteraction = () => { if(!hasUserInteracted && video.muted){ video.muted=false; hasUserInteracted=true; } };
      ['click','touchstart','keydown'].forEach(ev => document.addEventListener(ev, enableSoundOnInteraction, { once:true }));

      try {
        enableAutoplay();
        await player.load(streamUrl);
        if (video.readyState >= 3) { await attemptAutoplay(); }
        else {
          video.addEventListener('canplay', attemptAutoplay, { once:true });
          setTimeout(async ()=>{ if (video.paused) await attemptAutoplay(); },2000);
        }
      } catch(e) { console.error('Load error:', e); }

      document.addEventListener('visibilitychange', ()=>{ if(!document.hidden && video.paused) attemptAutoplay(); });

      // end of original Shaka block (unchanged)
    });
  </script>

  <!-- ========== UI: Server2, Landscape Fullscreen ========== -->
  <script>
    const SERVICE2_URL = "https://lins.onrender.com/";

    (function(){
      const server2Btn = document.getElementById('server2Btn');
      const playerWrapper = document.getElementById('playerWrapper');
      const iframeWrapper = document.getElementById('iframeWrapper');
      const iframe = document.getElementById('server2Iframe');
      const shakaContainer = document.querySelector('.shaka-video-container');

      // overlay button (for landscape toggle)
      const overlayBtn = document.createElement('button');
      overlayBtn.className = 'overlay-btn';
      overlayBtn.title = 'Toggle landscape fullscreen';
      overlayBtn.setAttribute('aria-pressed','false');
      overlayBtn.innerText = '⟲';
      overlayBtn.style.display = 'none';
      playerWrapper.appendChild(overlayBtn);

      let openServer2 = false;
      let landscapeActive = false;

      // Landscape fullscreen toggle
      overlayBtn.addEventListener('click', async function(){
        if(!landscapeActive){
          // Enter landscape fullscreen
          playerWrapper.classList.add('landscape-fullscreen');
          overlayBtn.setAttribute('aria-pressed','true');
          overlayBtn.innerText = '×';
          landscapeActive = true;
          
          // Lock to landscape orientation if possible
          try {
            if (screen.orientation && screen.orientation.lock) {
              await screen.orientation.lock('landscape-primary');
            }
          } catch(e) {
            console.log('Orientation lock not supported');
          }
          
        } else {
          // Exit landscape fullscreen
          playerWrapper.classList.remove('landscape-fullscreen');
          overlayBtn.setAttribute('aria-pressed','false');
          overlayBtn.innerText = '⟲';
          landscapeActive = false;
          
          // Unlock orientation
          try {
            if (screen.orientation && screen.orientation.unlock) {
              screen.orientation.unlock();
            }
          } catch(e) {
            console.log('Orientation unlock not supported');
          }
        }
      });

      // Server2 toggle button
      server2Btn.addEventListener('click', function(){
        openServer2 = !openServer2;
        if(openServer2){
          // Hide main shaka player
          shakaContainer.style.display = 'none';
          // Show iframe and load
          iframe.src = SERVICE2_URL;
          iframeWrapper.style.display = 'block';
          iframeWrapper.setAttribute('aria-hidden','false');
          // Show overlay button
          overlayBtn.style.display = 'flex';
          server2Btn.innerText = 'Close Server 2';
          
        } else {
          // Close iframe
          iframe.src = '';
          iframeWrapper.style.display = 'none';
          iframeWrapper.setAttribute('aria-hidden','true');
          // Hide overlay button
          overlayBtn.style.display = 'none';
          server2Btn.innerText = 'Server 2';
          // Show main player back
          shakaContainer.style.display = '';
          
          // Reset landscape mode if active
          if(landscapeActive){
            playerWrapper.classList.remove('landscape-fullscreen');
            overlayBtn.setAttribute('aria-pressed','false');
            overlayBtn.innerText = '⟲';
            landscapeActive = false;
            try {
              if (screen.orientation && screen.orientation.unlock) {
                screen.orientation.unlock();
              }
            } catch(e) {}
          }
        }
      });

      // Escape key to exit landscape
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && landscapeActive) {
          playerWrapper.classList.remove('landscape-fullscreen');
          overlayBtn.setAttribute('aria-pressed','false');
          overlayBtn.innerText = '⟲';
          landscapeActive = false;
          try {
            if (screen.orientation && screen.orientation.unlock) {
              screen.orientation.unlock();
            }
          } catch(e) {}
        }
      });

      // Aspect select affects wrapper
      const aspectSelect = document.getElementById('aspectSelect');
      aspectSelect.addEventListener('change', ()=> {
        const cls = aspectSelect.value;
        playerWrapper.classList.remove('aspect-16-9','aspect-4-3','aspect-1-1','aspect-fit','aspect-fill');
        playerWrapper.classList.add(cls);
      });

      // Other button handlers
      document.getElementById('cinemaBtn').addEventListener('click', ()=>{
        document.body.classList.toggle('cinema-mode');
        if(document.body.classList.contains('cinema-mode')) {
          document.body.style.background='linear-gradient(180deg, rgba(6,24,36,0.95), rgba(15,25,30,0.95))';
        } else {
          document.body.style.background='';
        }
      });

      document.getElementById('fsBtn').addEventListener('click', ()=> {
        if(playerWrapper.requestFullscreen) {
          playerWrapper.requestFullscreen().catch(()=>{});
        }
      });

      document.getElementById('vrBtn').addEventListener('click', ()=> {
        alert('VR mode requires WebXR support.');
      });

    })();
  </script>
</body>
  </html>
