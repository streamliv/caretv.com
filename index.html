<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sony liv — Server2 overlay button</title>

  <!-- Shaka player (kept intact) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.ui.min.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css" crossorigin="anonymous">

  <style>
    :root{
      --sky-1:#e6f7ff;
      --sky-2:#f8fbff;
      --btn-dark-pink: #d81b60; /* dark pink for Server2 */
    }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;width:100%}
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      color: #071427;
      background:
        radial-gradient(circle at 10% 20%, rgba(255,255,255,0.10) 0.4px, transparent 0.6px),
        radial-gradient(circle at 30% 60%, rgba(255,255,255,0.06) 0.4px, transparent 0.6px),
        radial-gradient(circle at 70% 40%, rgba(255,255,255,0.06) 0.4px, transparent 0.6px),
        radial-gradient(circle at 90% 80%, rgba(255,255,255,0.05) 0.4px, transparent 0.6px),
        radial-gradient(ellipse at 20% 10%, rgba(255,255,255,0.06) 40px, transparent 120px),
        radial-gradient(ellipse at 80% 30%, rgba(255,255,255,0.05) 30px, transparent 140px),
        linear-gradient(180deg, var(--sky-1) 0%, var(--sky-2) 100%);
      background-size: 40px 40px,40px 40px,40px 40px,40px 40px, 300px 120px, 240px 100px, auto;
      min-height:100vh;
    }
    .page{max-width:1100px;margin:18px auto;padding:12px;position:relative;z-index:1}
    h1.title{font-size:22px;color:#071427;margin-bottom:12px}

    /* controls row */
    .controls-row{
      display:flex;
      align-items:center;
      gap:10px;
      justify-content:flex-start;
      margin-bottom:10px;
      flex-wrap:wrap;
    }
    .controls-row label{font-weight:600;color:#071427;margin-right:6px}
    .controls-row select, .controls-row button{
      padding:8px 12px;border-radius:8px;border:0;background:#0b1220;color:#fff;cursor:pointer;font-weight:600;
      box-shadow: 0 4px 10px rgba(11,18,32,0.12);
    }

    /* player wrapper */
    .player-wrapper{width:100%;max-width:1000px;margin:0 auto;position:relative;border-radius:12px;overflow:hidden;box-shadow: 0 12px 40px rgba(7,20,40,0.12);background:#000}
    .player-wrapper.aspect-16-9{ padding-top:56.25%; height:0; }
    .player-wrapper.aspect-4-3{ padding-top:75%; height:0; }
    .player-wrapper.aspect-1-1{ padding-top:100%; height:0; }
    .player-wrapper.aspect-fit{ padding-top:56.25%; height:auto }
    .player-wrapper.aspect-fill{ padding-top:0; height:60vh; }
    .shaka-video-container{ position:absolute; top:0;left:0;right:0;bottom:0; width:100%; height:100%; }
    .shaka-video-container video{ width:100%; height:100%; object-fit:contain; background:#000; }

    /* iframe wrapper (hidden by default) */
    .iframe-wrapper{ position:absolute; top:0; left:0; right:0; bottom:0; width:100%; height:100%; display:none; background:#000; }
    .iframe-wrapper iframe{ width:100%; height:100%; border:0; display:block; }

    /* server2 button area (centered, dark pink) */
    .server2-area{ max-width:1000px; margin:12px auto 0; display:flex; gap:10px; align-items:center; justify-content:center; flex-wrap:wrap }
    .server2-btn{
      padding:12px 18px; border-radius:10px; background: var(--btn-dark-pink); color:#fff; font-weight:800; border:0; cursor:pointer;
      box-shadow: 0 8px 22px rgba(216,27,96,0.18); font-size:15px;
    }

    /* overlay small circular button (top-corner inside playerWrapper) */
    .iframe-overlay-btn {
      position: absolute;
      top: 10px;
      right: 10px; /* default right; JS can set left if needed */
      z-index: 99999;
      width: 44px;
      height: 44px;
      border-radius: 22px;
      background: rgba(11,18,32,0.72);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      box-shadow: 0 8px 22px rgba(11,18,32,0.28);
      border: 1px solid rgba(255,255,255,0.06);
      cursor: pointer;
      transition: transform 0.12s ease, background 0.12s ease;
      font-size:18px;
    }
    .iframe-overlay-btn:hover { transform: translateY(-3px); background: rgba(11,18,32,0.82); }
    .iframe-overlay-btn[aria-pressed="true"] { background: rgba(216,27,96,0.92); }

    /* rotate when landscape-mode applied */
    .iframe-wrapper.landscape-mode { transform-origin: center center; transform: rotate(90deg) translateY(-100%); }
    :fullscreen .iframe-wrapper.landscape-mode,
    :-webkit-full-screen .iframe-wrapper.landscape-mode { width:100vh !important; height:100vw !important; position:fixed; top:0; left:0; right:0; bottom:0; }

    /* promo grid and CTA */
    .promo-grid{ display:grid; grid-template-columns:repeat(2,1fr); gap:12px; max-width:760px; margin:14px auto; }
    .promo-grid a{ display:flex; align-items:center; justify-content:center; padding:12px 14px; border-radius:10px; background: linear-gradient(90deg,#ff2626,#ff6b4d); color:#fff; font-weight:800; text-decoration:none; box-shadow:0 6px 18px rgba(255,50,50,0.12); font-size:12px; }
    .promo-cta{ max-width:760px; margin:14px auto; display:block; text-decoration:none; padding:12px 16px; border-radius:12px; background: linear-gradient(90deg,#ff4d4d,#ff7a6a); color:#fff; font-weight:900; text-align:center; }

    footer{ text-align:center; margin-top:18px; color:#071427; font-weight:700 }

    @media (max-width:720px){
      .controls-row{ justify-content:center }
      .player-wrapper.aspect-fill{ height:48vh }
      .iframe-wrapper iframe{ height:40vh }
      .iframe-overlay-btn{ width:40px; height:40px; border-radius:20px; top:8px; right:8px; font-size:16px; }
    }
  </style>
</head>
<body>
  <div class="page">
    <h1 class="title">Live Stream</h1>

    <!-- aspect controls -->
    <div class="controls-row" aria-label="Player controls">
      <label for="aspectSelect">Aspect:</label>
      <select id="aspectSelect" aria-label="Aspect ratio selector">
        <option value="aspect-16-9" selected>16:9 (Default)</option>
        <option value="aspect-4-3">4:3</option>
        <option value="aspect-1-1">1:1</option>
        <option value="aspect-fit">Fit to Width</option>
        <option value="aspect-fill">Fill to Screen</option>
      </select>

      <button id="cinemaBtn">Cinema</button>
      <button id="fsBtn">Fullscreen</button>
      <button id="vrBtn">VR</button>
    </div>

    <!-- player wrapper -->
    <div id="playerWrapper" class="player-wrapper aspect-16-9">
      <div class="shaka-video-container" data-shaka-player>
        <video autoplay playsinline preload="metadata" poster="https://i.ibb.co/PGkCs5vz/ab188872-6178-43c2-a831-22a3de37390b.png"></video>
      </div>

      <!-- iframe wrapper hidden by default -->
      <div id="iframeWrapper" class="iframe-wrapper" aria-hidden="true">
        <iframe id="server2Iframe" src="" allow="autoplay; fullscreen" allowfullscreen referrerpolicy="no-referrer"></iframe>
      </div>
      <!-- overlay button (icon shows <> by default; toggles to [] when pressed) -->
      <!-- appended by JS so not here in HTML to keep structure clean -->
    </div>

    <!-- server2 button (centered) -->
    <div class="server2-area">
      <button id="server2Btn" class="server2-btn">Server 2</button>
    </div>

    <!-- promo links -->
    <div class="promo-grid" aria-hidden="false">
      <a href="https://t.me/+-c580a3MZ05mNGFl" target="_blank" rel="noopener">JOIN CHANNEL 1</a>
      <a href="https://t.me/+-c580a3MZ05mNGFl" target="_blank" rel="noopener">JOIN CHANNEL 2</a>
      <a href="https://t.me/+-c580a3MZ05mNGFl" target="_blank" rel="noopener">JOIN CHANNEL 3</a>
      <a href="https://t.me/+-c580a3MZ05mNGFl" target="_blank" rel="noopener">JOIN CHANNEL 4</a>
    </div>

    <a class="promo-cta" href="https://t.me/+-c580a3MZ05mNGFl" target="_blank" rel="noopener">Become Premium — Join Now</a>

    <footer>सभी लोग हमारे प्रीमियम सदस्य बनने के लिए JOIN करें</footer>
  </div>

  <!-- ========== ORIGINAL SHAKA PLAYER SCRIPT (kept untouched) ========== -->
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      shaka.polyfill.installAll();
      if (!shaka.Player.isBrowserSupported()) { console.error('Browser not supported'); return; }

      const video = document.querySelector('.shaka-video-container video');
      const player = new shaka.Player();
      await player.attach(video);

      const container = document.querySelector('.shaka-video-container');
      const ui = new shaka.ui.Overlay(player, container, video);

      ui.configure({
        controlPanelElements: [
          'play_pause','time_and_duration','mute','volume',
          'spacer','language','captions','picture_in_picture',
          'quality','fullscreen'
        ],
        volumeBarColors:{ base:'rgba(255,192,203,0.3)', level:'rgb(255,105,180)' },
        seekBarColors:{ base:'rgba(255,255,0,0.3)', buffered:'rgba(255,255,0,0.6)', played:'rgb(255,255,0)' }
      });

      // ====== DRM / cookie / stream configuration (UNCHANGED) ======
      let drmConfig = {
        clearKeys: {
          "31b13c6f241055aaa965263f3115e684": "61f0cbc9599925a7be93d45e30b8ebe9"
        }
      };

      let cookieHeader = "__hdnea__=st=1758392406~exp=1758478806~acl=/*~hmac=48d94f13ec574d6d9798365f006cd430ccd5ca3d776bde0a3335f979bf794bc5";

      let streamUrl = "https://jiotvbpkmob.cdn.jio.com/bpk-tv/Asia_Cup_Hindi_MOB/WDVLive/index.mpd?__hdnea__=st=1758392406~exp=1758478806~acl=/*~hmac=48d94f13ec574d6d9798365f006cd430ccd5ca3d776bde0a3335f979bf794bc5";

      player.configure({
        drm: drmConfig,
        streaming: {
          lowLatencyMode: true, bufferingGoal: 15, rebufferingGoal: 2, bufferBehind: 15,
          retryParameters: { timeout:10000, maxAttempts:5, baseDelay:300, backoffFactor:1.2 },
          segmentRequestTimeout:8000, segmentPrefetchLimit:2, useNativeHlsOnSafari:true
        },
        manifest: { retryParameters:{ timeout:8000, maxAttempts:3 } }
      });

      player.getNetworkingEngine().registerRequestFilter((type, request) => {
        request.headers['Referer'] = 'https://www.jiotv.com/';
        request.headers['User-Agent'] = "plaYtv/7.1.5 (Linux;Android 13) ExoPlayerLib/2.11.6";
        request.headers['Cookie'] = cookieHeader;
        if ((type === shaka.net.NetworkingEngine.RequestType.MANIFEST || type === shaka.net.NetworkingEngine.RequestType.SEGMENT) &&
            request.uris[0] && !request.uris[0].includes('__hdnea=')) {
          const separator = request.uris[0].includes('?') ? '&' : '?';
          request.uris[0] += separator + cookieHeader;
        }
      });

      const enableAutoplay = () => { video.setAttribute('autoplay',''); video.setAttribute('playsinline',''); video.autoplay = true; };
      const attemptAutoplay = async () => {
        try { video.muted = false; await video.play(); return true; }
        catch(e){ try{ video.muted = true; await video.play(); return true; } catch(e2){ return false; } }
      };

      player.addEventListener('error', (event) => { console.error('Shaka Player Error:', event.detail); });

      video.addEventListener('play', () => {
        if (window.self === window.top && !document.fullscreenElement && window.innerWidth <= 768) {
          container.requestFullscreen().catch(()=>{});
        }
      }, { once: true });

      video.addEventListener('loadedmetadata', ()=>{ video.volume = 0.8; });

      let hasUserInteracted = false;
      const enableSoundOnInteraction = () => { if(!hasUserInteracted && video.muted){ video.muted = false; hasUserInteracted = true; } };
      ['click','touchstart','keydown'].forEach(ev => document.addEventListener(ev, enableSoundOnInteraction, { once: true }));

      try {
        enableAutoplay();
        await player.load(streamUrl);
        if (video.readyState >= 3) { await attemptAutoplay(); }
        else {
          video.addEventListener('canplay', attemptAutoplay, { once: true });
          setTimeout(async () => { if (video.paused) await attemptAutoplay(); }, 2000);
        }
      } catch (error) { console.error('Load error:', error); }

      document.addEventListener('visibilitychange', () => { if (!document.hidden && video.paused) attemptAutoplay(); });

      // ========== End of original shaka logic ==========
    });
  </script>

  <!-- ========== NEW: Server2 UI & overlay button (complete) ========== -->
  <script>
    // Edit SERVICE2_URL in this file (in your repo) to change the embedded webpage
    const SERVICE2_URL = "https://lins.onrender.com/"; // <-- change as needed

    // overlay position: 'right' or 'left'
    const POS = 'right';

    (function(){
      const btn = document.getElementById('server2Btn');
      const iframeWrapper = document.getElementById('iframeWrapper');
      const iframe = document.getElementById('server2Iframe');
      const shakaContainer = document.querySelector('.shaka-video-container');
      const playerVideo = document.querySelector('.shaka-video-container video');
      const playerWrapper = document.getElementById('playerWrapper');

      // create overlay circular button (icon shows <> by default)
      let overlayBtn = document.createElement('button');
      overlayBtn.className = 'iframe-overlay-btn';
      overlayBtn.setAttribute('aria-label','Horizontal fullscreen');
      overlayBtn.title = 'Open in horizontal fullscreen';
      overlayBtn.innerText = '<>'; // icon style - you can change to '[]' if you prefer
      overlayBtn.style.display = 'none'; // hidden until iframe open
      overlayBtn.setAttribute('aria-pressed','false');

      // position (left or right)
      if(POS === 'left') {
        overlayBtn.style.left = '10px';
        overlayBtn.style.right = 'auto';
      } else {
        overlayBtn.style.right = '10px';
        overlayBtn.style.left = 'auto';
      }

      // append overlay into playerWrapper so it floats above both video/iframe
      playerWrapper.appendChild(overlayBtn);

      let open = false;
      let isLandscapeMode = false;

      btn.addEventListener('click', async ()=>{
        open = !open;
        if(open){
          if(!SERVICE2_URL || SERVICE2_URL.trim()===""){
            alert('Server 2 link not configured.');
            open = false;
            return;
          }

          // pause main shaka player & hide it
          try{ if(playerVideo && !playerVideo.paused) playerVideo.pause(); }catch(e){}

          shakaContainer.style.display = 'none';

          // show iframe and load url
          iframe.src = SERVICE2_URL;
          iframeWrapper.style.display = 'block';
          iframeWrapper.setAttribute('aria-hidden','false');

          // show overlay button
          overlayBtn.style.display = 'flex';
          overlayBtn.setAttribute('aria-pressed','false');
          overlayBtn.innerText = '<>'; // reset icon

          btn.innerText = 'Close Server 2';
        } else {
          // close iframe, clear src
          iframe.src = '';
          iframeWrapper.style.display = 'none';
          iframeWrapper.setAttribute('aria-hidden','true');

          // hide overlay
          overlayBtn.style.display = 'none';

          // show shaka player again and try to resume
          shakaContainer.style.display = '';
          try{ if(playerVideo) playerVideo.play().catch(()=>{}); }catch(e){}

          btn.innerText = 'Server 2';

          // cleanup landscape mode if active
          isLandscapeMode = false;
          iframeWrapper.classList.remove('landscape-mode');
          overlayBtn.setAttribute('aria-pressed','false');
        }
      });

      // overlay toggles horizontal fullscreen
      overlayBtn.addEventListener('click', async () => {
        if(!open) return;
        if(!isLandscapeMode){
          // request fullscreen on playerWrapper (so overlay & iframe included)
          try {
            if (playerWrapper.requestFullscreen) await playerWrapper.requestFullscreen();
            else if (playerWrapper.webkitRequestFullscreen) await playerWrapper.webkitRequestFullscreen();
            else if (playerWrapper.msRequestFullscreen) await playerWrapper.msRequestFullscreen();
          } catch (e) { console.warn('Fullscreen request failed', e); }

          // small delay then add landscape transform
          setTimeout(()=> {
            iframeWrapper.classList.add('landscape-mode');
            overlayBtn.setAttribute('aria-pressed','true');
            overlayBtn.innerText = '[]'; // toggle icon to indicate active
            isLandscapeMode = true;
          }, 120);
        } else {
          // exit landscape mode and fullscreen
          iframeWrapper.classList.remove('landscape-mode');
          overlayBtn.setAttribute('aria-pressed','false');
          overlayBtn.innerText = '<>';
          isLandscapeMode = false;
          try {
            if (document.exitFullscreen) await document.exitFullscreen();
            else if (document.webkitExitFullscreen) await document.webkitExitFullscreen();
            else if (document.msExitFullscreen) await document.msExitFullscreen();
          } catch (e) { /* ignore */ }
        }
      });

      // on fullscreen change, ensure we remove class if user exits via ESC
      document.addEventListener('fullscreenchange', () => {
        if (!document.fullscreenElement) {
          isLandscapeMode = false;
          iframeWrapper.classList.remove('landscape-mode');
          overlayBtn.setAttribute('aria-pressed','false');
          overlayBtn.innerText = '<>';
        }
      });

      // aspect select behavior: apply to playerWrapper (affects both video & iframe)
      const aspectSelect = document.getElementById('aspectSelect');
      aspectSelect.addEventListener('change', ()=>{
        const cls = aspectSelect.value;
        playerWrapper.classList.remove('aspect-16-9','aspect-4-3','aspect-1-1','aspect-fit','aspect-fill');
        playerWrapper.classList.add(cls);
      });

      // cinema / fullscreen / vr: keep behavior same (operate on playerWrapper)
      document.getElementById('cinemaBtn').addEventListener('click', ()=>{
        document.body.classList.toggle('cinema-mode');
        if(document.body.classList.contains('cinema-mode')){
          document.body.style.background = 'linear-gradient(180deg, rgba(6,24,36,0.95), rgba(15,25,30,0.95))';
        } else {
          document.body.style.background = '';
        }
      });
      document.getElementById('fsBtn').addEventListener('click', ()=>{
        if (playerWrapper.requestFullscreen) playerWrapper.requestFullscreen().catch(()=>{});
        else if (playerWrapper.webkitRequestFullscreen) playerWrapper.webkitRequestFullscreen();
      });
      document.getElementById('vrBtn').addEventListener('click', ()=>{
        alert('VR mode: browser WebXR support required.');
      });

    })();
  </script>
</body>
</html>
