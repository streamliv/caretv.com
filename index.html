<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
  <title>Live Stream — 9:16 Server2</title>

  <!-- Shaka (unchanged) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/shaka-player.ui.min.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.7.11/controls.min.css" crossorigin="anonymous">

  <style>
    :root{ --vh: 100dvh; }
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;width:100%}
    body{font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:#e6f7ff}

    .page{max-width:1100px;margin:18px auto;padding:12px}
    h1.title{font-size:20px;margin-bottom:10px}

    .controls-row{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:10px}
    .controls-row select,.controls-row button{padding:8px 12px;border-radius:8px;border:0;background:#0b1220;color:#fff;font-weight:600}

    .player-wrapper{position:relative;width:100%;max-width:1000px;margin:0 auto;border-radius:12px;overflow:hidden;background:#000}
    .player-wrapper.aspect-16-9{padding-top:56.25%}
    .shaka-video-container{position:absolute;inset:0}
    .shaka-video-container video{width:100%;height:100%;object-fit:contain;background:#000}

    /* SERVER 2: always portrait 9:16 frame */
    .iframe-wrapper{position:absolute;inset:0;display:none;background:#000;align-items:center;justify-content:center}
    .server2-portrait{
      position:relative; width:min(56.25vh, 100%); height:min(var(--vh), 100%); /* keep 9:16 inside area */
      aspect-ratio:9/16; background:#000; overflow:hidden; touch-action:none; will-change:transform;
    }
    .server2-portrait iframe{position:absolute;inset:0;width:100%;height:100%;border:0;background:#000}

    /* LANDSCAPE FILL CONTAINER (rotated device) */
    .landscape-full{
      position:fixed !important; inset:0 !important; width:100vw !important; height:100dvh !important; background:#000 !important;
      z-index:9999 !important; border-radius:0 !important; max-width:none !important; padding-top:0 !important; display:flex; align-items:center; justify-content:center;
    }

    /* Zoom HUD + button */
    .zoom-hud{position:fixed;left:12px;top:12px;background:rgba(11,18,32,0.7);color:#fff;padding:4px 8px;border-radius:6px;font-size:12px;z-index:10001;display:none}
    .overlay-btn{position:fixed;right:12px;top:12px;width:44px;height:44px;border-radius:22px;background:#d81b60;color:#fff;font-weight:800;border:0;z-index:10001;display:none}

    .server2-area{max-width:1000px;margin:12px auto;display:flex;justify-content:center}
    .server2-btn{padding:12px 18px;border-radius:10px;background:#d81b60;color:#fff;font-weight:800;border:0;cursor:pointer}
  </style>
</head>
<body>
  <div class="page">
    <h1 class="title">Live Stream</h1>

    <div class="controls-row">
      <select id="aspectSelect">
        <option value="aspect-16-9" selected>16:9</option>
      </select>
      <button id="fsBtn">Fullscreen</button>
    </div>

    <div id="playerWrapper" class="player-wrapper aspect-16-9">
      <!-- Shaka main player (unchanged) -->
      <div class="shaka-video-container" data-shaka-player>
        <video id="mainVideo" autoplay playsinline preload="metadata" poster="https://i.ibb.co/PGkCs5vz/ab188872-6178-43c2-a831-22a3de37390b.png"></video>
      </div>

      <!-- SERVER 2: strictly portrait box -->
      <div id="iframeWrapper" class="iframe-wrapper" aria-hidden="true">
        <div id="portraitBox" class="server2-portrait">
          <iframe id="server2Iframe" src="" allow="autoplay; fullscreen" allowfullscreen referrerpolicy="no-referrer"></iframe>
        </div>
      </div>

      <div id="zoomHud" class="zoom-hud">Zoom 100%</div>
      <button id="landBtn" class="overlay-btn">×</button>
    </div>

    <div class="server2-area"><button id="server2Btn" class="server2-btn">Server 2</button></div>
  </div>

  <!-- Shaka init (unchanged skeleton) -->
  <script>
    (function fixVH(){
      const set = ()=>document.documentElement.style.setProperty('--vh', window.innerHeight+'px');
      set(); addEventListener('resize', set); addEventListener('orientationchange', set);
    })();
    document.addEventListener('DOMContentLoaded', async ()=>{
      shaka.polyfill.installAll();
      if(!shaka.Player.isBrowserSupported()) return;
      const video=document.getElementById('mainVideo');
      const player=new shaka.Player(); await player.attach(video);
      const ui=new shaka.ui.Overlay(player, document.querySelector('.shaka-video-container'), video);
      ui.configure({ controlPanelElements:['play_pause','time_and_duration','mute','volume','spacer','quality','fullscreen'] });

      // demo stream config (unchanged)
      let cookie="__hdnea__=st=1758392406~exp=1758478806~acl=/*~hmac=48d94f13ec574d6d9798365f006cd430ccd5ca3d776bde0a3335f979bf794bc5";
      player.configure({ drm:{ clearKeys:{ "31b13c6f241055aaa965263f3115e684":"61f0cbc9599925a7be93d45e30b8ebe9" } }});
      player.getNetworkingEngine().registerRequestFilter((t,req)=>{ req.headers['Cookie']=cookie; });
      try{ await player.load("https://jiotvbpkmob.cdn.jio.com/bpk-tv/Asia_Cup_Hindi_MOB/WDVLive/index.mpd?"+cookie); video.muted=true; await video.play(); }catch(e){}
    });
  </script>

  <!-- Server 2 portrait + force landscape + pinch zoom -->
  <script>
    const SERVICE2_URL="https://lins.onrender.com/"; // replace with actual

    (function(){
      const playerWrapper=document.getElementById('playerWrapper');
      const shakaContainer=document.querySelector('.shaka-video-container');
      const iframeWrapper=document.getElementById('iframeWrapper');
      const portraitBox=document.getElementById('portraitBox'); // pinch target
      const iframe=document.getElementById('server2Iframe');

      const server2Btn=document.getElementById('server2Btn');
      const landBtn=document.getElementById('landBtn');
      const zoomHud=document.getElementById('zoomHud');

      let open=false, land=true; // Server2 will always open in landscape mode
      let scale=1, panX=0, panY=0, evCache=[], prevDist=-1, minS=1, maxS=3;

      async function lockLandscape(){
        try{ if(screen.orientation?.lock) await screen.orientation.lock('landscape-primary'); }catch(e){}
      }
      function unlock(){ try{ screen.orientation?.unlock?.(); }catch(e){} }

      function enterLandscape(){
        playerWrapper.classList.add('landscape-full');
        landBtn.style.display='block'; zoomHud.style.display='block';
      }
      function exitLandscape(){
        playerWrapper.classList.remove('landscape-full');
        landBtn.style.display='none'; zoomHud.style.display='none'; unlock();
      }

      function openServer2(){
        open=true;
        shakaContainer.style.display='none';
        iframeWrapper.style.display='flex';
        iframeWrapper.setAttribute('aria-hidden','false');
        iframe.src=SERVICE2_URL+(SERVICE2_URL.includes('?')?'&':'?')+'autoplay=1';
        // Force landscape immediately
        enterLandscape(); lockLandscape();
        landBtn.textContent='×';
        // reset zoom
        scale=1; panX=0; panY=0; applyTransform();
      }
      function closeServer2(){
        open=false;
        iframe.src=''; iframeWrapper.style.display='none'; iframeWrapper.setAttribute('aria-hidden','true');
        shakaContainer.style.display='';
        exitLandscape();
      }

      server2Btn.addEventListener('click', ()=>{ open ? closeServer2() : openServer2(); });
      landBtn.addEventListener('click', ()=>{ /* keep forced landscape only for Server 2 */
        if(!open){ return; }
        // toggle exit
        if(playerWrapper.classList.contains('landscape-full')){ exitLandscape(); }
        else{ enterLandscape(); lockLandscape(); }
      });

      // Pinch zoom + pan on portrait box
      function applyTransform(){
        portraitBox.style.transform=`translate(${panX}px,${panY}px) scale(${scale})`;
        zoomHud.textContent=`Zoom ${Math.round(scale*100)}%`;
      }
      function updateCache(ev){ const i=evCache.findIndex(e=>e.pointerId===ev.pointerId); if(i>-1) evCache[i]=ev; else evCache.push(ev); }
      function removeFromCache(ev){ const i=evCache.findIndex(e=>e.pointerId===ev.pointerId); if(i>-1) evCache.splice(i,1); if(evCache.length<2) prevDist=-1; }

      portraitBox.addEventListener('pointerdown', ev=>{ portraitBox.setPointerCapture(ev.pointerId); updateCache(ev); }, {passive:true});
      portraitBox.addEventListener('pointermove', ev=>{
        updateCache(ev);
        if(evCache.length===2){
          ev.preventDefault();
          const d=Math.hypot(evCache[0].clientX-evCache[1].clientX, evCache[0].clientY-evCache[1].clientY);
          if(prevDist>0){
            const ns=Math.min(maxS, Math.max(minS, scale*(d/prevDist)));
            // keep midpoint stable
            const midX=(evCache[0].clientX+evCache[1].clientX)/2 - innerWidth/2;
            const midY=(evCache[0].clientY+evCache[1].clientY)/2 - innerHeight/2;
            panX += (panX-midX)*(ns/scale-1);
            panY += (panY-midY)*(ns/scale-1);
            scale=ns; applyTransform();
          }
          prevDist=d;
        }else if(evCache.length===1){
          panX += ev.movementX; panY += ev.movementY; applyTransform();
        }
      }, {passive:false});
      ['pointerup','pointercancel','pointerout','pointerleave'].forEach(t=>portraitBox.addEventListener(t, removeFromCache));

      // Optional: hardware back / ESC exits Server2
      addEventListener('keydown', e=>{ if(e.key==='Escape' && open) closeServer2(); });

      // Initial attach of overlay controls visibility tied to Server2 only
      new MutationObserver(()=>{
        landBtn.style.display = open ? 'block' : 'none';
        zoomHud.style.display = open ? 'block' : 'none';
      }).observe(iframeWrapper,{attributes:true});
    })();
  </script>
</body>
</html>
